# Yelp(大部分)是如何关闭自己的数据中心并转移到 AWS TechCrunch 的

> 原文：<https://web.archive.org/web/https://techcrunch.com/2018/06/04/how-yelp-mostly-shut-down-its-own-data-centers-and-moved-to-aws/>

回到 2013 年， [Yelp](https://web.archive.org/web/20221025222551/https://github.com/) 是一家 9 岁的公司，建立在一套内部系统之上。It 部门逐渐意识到，运营自己的数据中心可能不是经营一家持续快速扩张的企业的最有效方式。与此同时，该公司明白，自 2004 年推出以来，技术世界已经发生了巨大变化，它需要将底层技术转变为更现代的方法。

Yelp 的工程 SVP 贾森·芬内尔说，一口吞下这么多东西太难了，但这不是偶然或一夜之间发生的事情。该公司的绝大多数数据都在一个不断变大的大型 Python 存储库中处理。关于转向微服务架构的讨论始于 2012 年。

该公司还在自己的数据中心内运行大规模的 Yelp 应用程序，随着它的发展，它越来越受到采购和在线获得新硬件所需的较长交付时间的限制。它看到这是一个长期不可持续的情况，并开始了一个从在内部运行巨大的单片应用程序到构建在云中运行的微服务的转变过程。这是一次不寻常的旅行。

## 数据中心难题

芬内尔描述了一个公司可以从向云的转变中受益的经典场景。Yelp 有一个小型运营团队专门负责安装新机器。当工程部门预计到新的资源需求时，他们必须给运营团队足够的时间来订购新的服务器并让它们正常运行，这当然不是处理资源问题的最有效方式，也不是可以通过云轻松解决的方式。

![](img/ebce257c93aec49b69b4199538cd3d32.png)

“我们不断遇到瓶颈，我当时负责搜索团队的大部分工作，我不得不预测 6-9 个月的容量。然后，订购机器需要几个月时间，安装机器又需要几个月时间，”芬内尔解释道。他强调说，负责启动这些机器的团队正在努力工作，但人手太少，需求太多，必须做出一些牺牲。

“我们正处于风口浪尖。芬内尔解释说:“我们本可以大幅扩大团队规模，在建设数据中心和购买服务器方面做得更好，并快速完成这些工作，但我们听到了很多 AWS 及其优势。

## 向云！

他们观察了 2013 年的云市场格局，AWS 显然是技术上的领导者。这意味着将他们的部分业务转移到 EC2。不幸的是，这暴露了一个新问题:如何在云中管理这个新的基础设施。这是在云原生计算的概念出现之前。没有什么库本内特斯 T2。当然，谷歌在内部以云原生的方式运营，但对于大多数没有庞大工程师团队的公司来说，这并不是一个真正的选择。

![](img/82c938d4b87ecdbf5b7a782aacaf0162.png)

Yelp 需要探索在混合云环境中管理运营的新方法，在混合云环境中，一些应用程序和数据位于云中，一些位于他们的数据中心。在 2013 年，这不是一个容易解决的问题，Yelp 必须有创造力才能让它发挥作用。

这意味着一只脚留在公共云中，另一只脚留在私有数据中心。帮助简化过渡的一个工具是 AWS Direct Connect ，它于前一年发布，使 Yelp 能够直接从他们的数据中心连接到云。

## 奠定基础

大约就在这个时候，当他们弄清楚 AWS 是如何工作的时候，另一场革命性的技术变革正在发生[，Docker 出现了](https://web.archive.org/web/20221025222551/https://techcrunch.com/2014/08/04/docker-sells-dotcloud-to-cloudcontrol-to-focus-on-core-container-business/)，并开始将集装箱化的概念纳入主流。“这是另一件具有革命性的事情。我们可以突然从运行程序的机器上分离出运行程序的上下文。Docker 为您提供了这个容器，比虚拟化和在一台机器上运行完整的操作系统要轻得多，”Fennell 解释道。

![](img/d49951ddd4bb6f10884eebffaf7c0773.png)

另一件正在发生的事情是名为 Mesos 的开源数据中心[操作系统的出现，它提供了一种将数据中心视为单一资源池的方式。他们可以将这个概念应用到数据和应用程序所在的任何地方。Mesos 还提供了一个名为](https://web.archive.org/web/20221025222551/https://techcrunch.com/2013/09/26/mesosphere-adds-docker-support-to-its-mesos-based-operating-system-for-the-data-center/)[马拉松](https://web.archive.org/web/20221025222551/https://mesosphere.github.io/marathon/)的容器编排工具，在 [Kubernetes 出现之前，Kubernetes 是一种处理相同问题的流行方式](https://web.archive.org/web/20221025222551/https://techcrunch.com/2018/05/06/kubernetes-stands-at-an-important-inflection-point/)。

“我们喜欢 Mesos 作为资源分配框架。它抽走了一队机器。Mesos 抽象了许多机器，并在它们之间控制程序。马拉松保证了哪些集装箱在哪里运行。我们可以将所有这些整合到这个清晰的自以为是的界面中，”他说。

## 齐心协力

在这一切发生的同时，Yelp 开始探索如何迁移到云，并使用平台即服务的方法来实现软件层。问题是在他们开始的时候，没有任何可行的方法来做到这一点。在像这样的大型转型中，在购买还是构建的决策过程中，他们觉得除了自己构建平台层之外别无选择。

2013 年末，他们开始在 Mesos 和 Docker 的基础上构建这个平台，并将其命名为 PaaSTA，这是一个内部笑话，代表平台即服务，非常棒。它被简称为意大利面。

![](img/ef5e321eeb1d5ea2e7abd217fb3e8c3e.png)

图片:大卫·西佛曼/盖蒂图片社

这个项目有一个雄心勃勃的目标:在谷歌之外的大多数人使用这个术语之前，让他们的基础设施作为一个单一的结构，以一种云原生的方式工作。Pasta 发展缓慢，2014 年 8 月第一个开发者作品上线，同年 12 月第一个生产服务上线。该公司实际上在第二年就开源了这项技术。

“Pasta 为我们提供了应用程序和开发团队之间的接口。运营部门必须确保 Pasta 启动并运行，而开发部门则负责实现实现接口的容器，”Fennell 说。

## 向公共云的更深处转移

当 Yelp 忙于构建这些内部系统时，AWS 并没有坐以待毙。它还通过新的实例类型、新的功能以及更好的 API 和工具来改进其产品。Fennell 报告说，这极大地帮助了 Yelp 开始更全面地向云迁移。

他说，随着他们将越来越多的应用程序转移到 AWS，包括最终的主数据库，有几个转折点。这一切都发生在最近几年，因为他们更好地理解了如何在他们居住的地方使用面食来控制过程。此外，他表示，由于内部数据中心和 AWS 之间的集成更加紧密，采用其他 AWS 服务现在也是可能的。

![](img/ad1d1107c0b2b06f88bff21d8067b426.png)

图片:erhui1979/Getty Images

第一个转折点出现在 2016 年左右，因为所有新服务都是为云配置的。他说，他们开始更好地管理 AWS 中的应用程序和基础设施，他们的思维从如何迁移到 AWS 转向如何运营和管理它。

也许这一长达数年的转型中最大的一步发生在去年夏天，当时 Yelp 将其主数据库从自己的数据中心转移到了 AWS。“这是我们最不需要处理的事情。否则就是清理。截至 2018 年，我们通过物理数据中心提供零生产流量服务，”他说。虽然他们仍然有两个数据中心，但他们已经接近目标，他们拥有运行网络主干所需的最低硬件。

Fennell 说，他们花了两周到一个月的时间来启动和运行一项服务，而这一切只需要几分钟。他说，任何因迁移到云而失去的控制都很容易被使用云基础设施的便利所抵消。“我们开始关注我们能增加价值的东西，”他说——这是每家公司的目标。